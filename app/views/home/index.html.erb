<div class="max-w-[85rem] px-4 py-6 sm:px-6 lg:px-8 lg:py-10 mx-auto" data-controller="calagem">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
    <div class="lg:col-span-4 space-y-6">
      <div class="flex flex-col bg-white border shadow-sm rounded-xl p-4 md:p-5 dark:bg-slate-900 dark:border-gray-700">
        <h2 class="text-lg font-bold text-gray-800 dark:text-white mb-4 border-b pb-2">
          Análise de Solo
        </h2>

        <div class="mb-6 p-3 bg-blue-50 border border-blue-100 rounded-lg dark:bg-blue-900/10 dark:border-blue-800">
          <label class="block text-xs font-bold uppercase text-blue-600 dark:text-blue-400 mb-1">Área de Aplicação (ha)</label>
          <input type="number"
                 data-calagem-target="area"
                 data-action="input->calagem#calculate"
                 class="py-2 px-3 block w-full border-gray-200 rounded-lg text-sm focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400" 
                 placeholder="0.00">
        </div>

        <div class="grid grid-cols-2 gap-4">
          <%
            params_list = [
              { id: "CTC", label: "CTC" },
              { id: "PRNT", label: "PRNT (%)", default: 100 },
              { id: "Ve", label: "V<sub>e</sub> (%)" },
              { id: "Va", label: "V<sub>a</sub> (%)" },
              { id: "Al", label: "Al (cmol<sub>c</sub>/dm<sup>3</sup>)" },
              { id: "Ca", label: "Ca (cmol<sub>c</sub>/dm<sup>3</sup>)" },
              { id: "Mg", label: "Mg (cmol<sub>c</sub>/dm<sup>3</sup>)" },
              { id: "ca_mg", label: "Relação Ca/Mg" },
              { id: "Y", label: "Y*" },
              { id: "X", label: "X (cmol<sub>c</sub>/dm<sup>3</sup>) *" },
              { id: "mt", label: "m<sub>t</sub> (%) *" }
            ]
          %>

          <% params_list.each do |item| %>
            <div>
              <label for="<%= item[:id] %>" class="block text-xs font-medium mb-1 dark:text-white">
                <%= item[:label].html_safe %>
              </label>
              <input type="number"
                     id="<%= item[:id] %>"
                     data-calagem-target="input"
                     data-param-name="<%= item[:id] %>"
                     data-action="input->calagem#calculate"
                     step="0.01"
                     <% if item[:default] %>value="<%= item[:default] %>"<% end %>
                     class="py-2 px-3 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-slate-900 dark:border-gray-700 dark:text-gray-400"
                     placeholder="0.00">
            </div>
          <% end %>
        </div>

        <div class="mt-4 pt-2 border-t border-gray-100 dark:border-gray-800">
          <p class="text-[10px] text-gray-500 dark:text-gray-400 leading-tight">
            * <strong>X, Y, m<sub>t</sub>:</strong> Fatores de correção e tolerância específicos para a cultura e região. Consulte o <strong>Quadro 8.1</strong> do manual <em>5<sup>a</sup> Aproximação</em> para obter os valores para o cálculo específico.
          </p>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-6">
          <button type="button" data-action="click->calagem#calculate" class="py-2.5 px-4 inline-flex justify-center items-center text-sm font-semibold rounded-lg bg-blue-600 text-white hover:bg-blue-700">
            Calcular
          </button>
          <button type="button" data-action="click->calagem#reset" class="py-2.5 px-4 inline-flex justify-center items-center text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 hover:bg-gray-50 dark:bg-slate-900 dark:border-gray-700 dark:text-white">
            Limpar
          </button>
        </div>
      </div>

      <div class="bg-white border shadow-sm rounded-xl p-4 md:p-5 dark:bg-slate-900 dark:border-gray-700">
        <h2 class="text-xs font-bold text-gray-500 mb-4 text-center">Necessidade do Solo (t ha<sup>-1</sup>)</h2>
        <div class="grid grid-cols-2 gap-4">
          <div class="text-center p-3 bg-gray-50 rounded-lg dark:bg-slate-800">
            <span class="block text-[10px] text-gray-500 mb-1">Saturação de Bases</span>
            <span class="text-xl font-bold text-blue-600" data-calagem-target="saturacaoResult">0.00</span>
          </div>
          <div class="text-center p-3 bg-gray-50 rounded-lg dark:bg-slate-800">
            <span class="block text-[10px] text-gray-500 mb-1">Neutralização de Al<sup>+3</sup></span>
            <span class="text-xl font-bold text-blue-600" data-calagem-target="neutralizacaoResult">0.00</span>
          </div>
        </div>
      </div>
    </div>

    <div class="lg:col-span-8">
      <div class="flex flex-col bg-white border shadow-sm rounded-xl dark:bg-slate-900 dark:border-gray-700 min-h-full">
        <div class="p-4 md:p-5 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4 bg-gray-50/50 dark:bg-white/5 rounded-t-xl">
          <div class="text-center sm:text-left">
            <h2 class="text-lg font-bold text-gray-800 dark:text-white">Comparativo Financeiro</h2>
            <p class="text-sm text-gray-500">Custo real baseado em produtos comerciais</p>
          </div>
          <button type="button" data-action="click->calagem#addProduct" class="w-full sm:w-auto py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700">
            + Novo Produto
          </button>
        </div>

        <div class="p-4 overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-slate-800">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">PRNT %</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Preço/t</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Frete/t</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
              </tr>
            </thead>
            <tbody data-calagem-target="productList" class="divide-y divide-gray-200 dark:divide-gray-700">
              </tbody>
          </table>

          <div data-calagem-target="emptyState" class="py-12 text-center">
            <p class="text-sm text-gray-500 italic">Clique em "+ Novo Produto" para comparar orçamentos.</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <template data-calagem-target="productTemplate">
    <tr class="product-row animate-in fade-in slide-in-from-top-1 duration-200">
      <td class="p-3"><input type="text" class="w-full bg-transparent border-none text-sm p-0 dark:text-white focus:ring-0" placeholder="Nome"></td>
      <td class="p-3"><input type="number" value="100" data-action="input->calagem#calculate" class="product-prnt w-16 py-1 px-2 border-gray-200 rounded-lg text-sm dark:bg-slate-900 dark:border-gray-700"></td>
      <td class="p-3"><input type="number" data-action="input->calagem#calculate" class="product-price w-20 py-1 px-2 border-gray-200 rounded-lg text-sm dark:bg-slate-900 dark:border-gray-700"></td>
      <td class="p-3"><input type="number" data-action="input->calagem#calculate" class="product-freight w-20 py-1 px-2 border-gray-200 rounded-lg text-sm dark:bg-slate-900 dark:border-gray-700"></td>
      <td class="p-3 text-right">
        <div class="flex flex-col">
          <span class="text-sm font-bold text-green-600 row-total">R$ 0,00</span>
          <span class="text-[10px] text-gray-500 row-tons">0.00 t</span>
        </div>
      </td>
    </tr>
  </template>
</div>
